# Основные команды Git: merge, rebase, switch, restore, checkout, cherry-pick, reset и stash

Этот конспект объясняет ключевые команды Git, их назначение и различия, с акцентом на практическое применение. Все примеры приведены для лучшего понимания.

## 1. Merge vs Rebase

`git merge` и `git rebase` — это команды для интеграции изменений из одной ветки в другую, но они работают по-разному и имеют разные сценарии использования.

### `git merge`

- **Описание**: Объединяет изменения из одной ветки в другую, создавая **merge commit** (слияние), если есть расхождения в истории.
- **Особенности**:
  - Сохраняет историю обеих веток, включая все коммиты.
  - Создаёт нелинейную историю с merge-коммитами, что может усложнить чтение лога.
  - Неразрушающая операция: исходные ветки остаются неизменными.
- **Когда использовать**:
  - Для сохранения полной истории изменений.
  - В командной работе, когда важно сохранить контекст веток.
  - На публичных ветках, где переписывание истории нежелательно.

### `git rebase`

- **Описание**: Переносит коммиты текущей ветки на вершину другой, переписывая историю.
- **Особенности**:
  - Создаёт линейную историю, как будто вы работали на основе последней версии целевой ветки.
  - Переписывает историю, что может быть опасно для уже опубликованных коммитов.
  - Может привести к конфликтам, которые нужно разрешать для каждого коммита.
- **Когда использовать**:
  - Для создания чистой, линейной истории.
  - На локальных ветках перед их слиянием в основную.
  - Не используйте на публичных ветках, чтобы избежать проблем для других разработчиков.
- **Источник**: [Atlassian Git Tutorial: Merging vs. Rebasing](https://www.atlassian.com/git/tutorials/merging-vs-rebasing)

## 2. Switch, Restore, Checkout

Эти команды используются для навигации по веткам, изменения состояния файлов и управления HEAD в Git.

### `git switch`

- **Описание**: Переключает текущую ветку на другую. Введена в Git 2.23 как более понятная альтернатива `git checkout` для работы с ветками.
- **Особенности**:
  - Работает только с ветками.
  - Не затрагивает файлы в рабочей директории, если они не конфликтуют.
- **Когда использовать**: Для переключения между ветками.

### `git restore`

- **Описание**: Восстанавливает файлы в рабочей директории или индексе до определённого состояния. Также введена в Git 2.23.
- **Особенности**:
  - Заменяет часть функционала `git checkout` для работы с файлами.
  - Может отменить изменения в рабочей директории (`--worktree`) или индексе (`--staged`).
- **Когда использовать**: Для отмены изменений в файлах или индексе.

### `git checkout`

- **Описание**: Универсальная команда для переключения веток, восстановления файлов или перемещения HEAD к определённому коммиту.
- **Особенности**:
  - Может работать с ветками, файлами или коммитами.
  - Может привести к состоянию "detached HEAD", если указать коммит, а не ветку.
  - Частично заменена `switch` и `restore` в новых версиях Git.
- **Когда использовать**: Когда нужно выполнить действия, недоступные через `switch` или `restore`, или в старых версиях Git.
- **Источник**: [Atlassian Git Tutorial: Resetting, Checking Out & Reverting](https://www.atlassian.com/git/tutorials/resetting-checking-out-and-reverting)

## 3. Cherry-pick

### `git cherry-pick`

- **Описание**: Копирует конкретный коммит из одной ветки и применяет его к текущей.
- **Особенности**:
  - Полезно для выборочного переноса изменений.
  - Может создавать дублирующиеся коммиты, если не использовать с осторожностью.
  - Не заменяет `merge` или `rebase` в большинстве случаев.
- **Когда использовать**:
  - Для переноса исправления бага из одной ветки в другую.
  - Когда нужно применить отдельный коммит без слияния всей ветки.
- **Источник**: [Atlassian Git Tutorial: Git Cherry Pick](https://www.atlassian.com/git/tutorials/cherry-pick)

## 4. Reset --soft/--hard

`git reset` используется для возврата ветки к определённому состоянию, изменяя историю коммитов, индекс или рабочую директорию.

### `git reset --soft`

- **Описание**: Сбрасывает HEAD до указанного коммита, сохраняя изменения в индексе и рабочей директории.
- **Особенности**:
  - Не удаляет изменения в файлах.
  - Полезно для объединения коммитов или изменения их сообщений.
- **Когда использовать**: Для корректировки истории без потери изменений.

### `git reset --hard`

- **Описание**: Полностью сбрасывает HEAD, индекс и рабочую директорию до указанного коммита.
- **Особенности**:
  - Удаляет все изменения после указанного коммита.
  - Разрушающая операция: потерянные изменения нельзя восстановить без `git reflog`.
- **Когда использовать**: Для полного отката к предыдущему состоянию (осторожно на публичных ветках!).
- **Источник**: [GitKraken: Git Reset](https://www.gitkraken.com/learn/git/git-reset)

## 5. Stash

### `git stash`

- **Описание**: Временно сохраняет изменения в рабочей директории и индексе, не создавая коммит, и очищает рабочую директорию.
- **Особенности**:
  - Полезно для переключения на другую задачу без коммита незавершённых изменений.
  - Сохранённые изменения можно восстановить позже.
- **Основные команды**:
  - `git stash push`: Сохраняет изменения в стэш.
  - `git stash list`: Показывает список сохранённых стэшей.
  - `git stash apply`: Применяет последний стэш, оставляя его в списке.
  - `git stash pop`: Применяет последний стэш и удаляет его из списка.
  - `git stash drop`: Удаляет указанный стэш.
- **Когда использовать**:
  - Когда нужно временно отложить изменения, чтобы переключиться на другую ветку.
  - Для сохранения незавершённой работы перед `pull` или `rebase`.
- **Источник**: [Tutorialspoint: Git Stash Operation](https://www.tutorialspoint.com/git/git_stash_operation.htm)

## 6. Примеры кода в контексте проекта

Ниже приведён пример сценария работы над проектом, демонстрирующий использование всех описанных команд. Предположим, у нас есть репозиторий `my-project` с двумя ветками: `main` и `feature`.

### Инициализация проекта

```bash
mkdir my-project
cd my-project
git init
echo "Initial content" > file.txt
git add file.txt
git commit -m "Initial commit"
```

### Создание и переключение на ветку (`switch`, `checkout`)

```bash
git branch feature
git switch feature  # или git checkout feature
echo "Feature update" >> file.txt
git add file.txt
git commit -m "Add feature update"
```

### Слияние веток (`merge`)

```bash
git switch main
git merge feature
```

Результат: изменения из `feature` объединены в `main` с созданием merge-коммита (если были конфликты).

### Альтернатива: переписывание истории (`rebase`)

```bash
git switch feature
git rebase main
```

Результат: коммиты из `feature` перенесены на вершину `main`, создавая линейную историю.

### Выборочный перенос коммита (`cherry-pick`)

Предположим, в ветке `feature` есть коммит `a1b2c3d` с важным исправлением:

```bash
git switch main
git cherry-pick a1b2c3d
```

Результат: коммит `a1b2c3d` применён к `main`.

### Отмена изменений в файле (`restore`, `checkout`)

Допустим, вы изменили `file.txt`, но хотите отменить изменения:

```bash
echo "Unwanted change" >> file.txt
git restore file.txt  # или git checkout -- file.txt
```

Результат: `file.txt` восстановлен до последнего закоммиченного состояния.

### Сброс коммитов (`reset --soft/--hard`)

После создания нового коммита:

```bash
echo "Temp change" >> file.txt
git add file.txt
git commit -m "Temp commit"
```

- Откат с сохранением изменений:
  ```bash
  git reset --soft HEAD~1
  ```
  Результат: коммит удалён, но изменения остались в индексе.
- Полный откат:
  ```bash
  git reset --hard HEAD~1
  ```
  Результат: коммит и изменения полностью удалены.

### Временное сохранение изменений (`stash`)

Вы начали изменять `file.txt`, но нужно переключиться на другую задачу:

```bash
echo "WIP change" >> file.txt
git stash push -m "Work in progress"
git switch main
# ... работаем на main ...
git switch feature
git stash pop
```

Результат: изменения из стэша восстановлены в ветке `feature`.

## Заключение

Каждая из этих команд имеет свои сценарии использования:

- **Merge** — для сохранения истории и командной работы.
- **Rebase** — для чистой линейной истории.
- **Switch** — для переключения веток.
- **Restore** — для отмены изменений в файлах.
- **Checkout** — универсальная команда для веток, файлов и коммитов.
- **Cherry-pick** — для выборочного переноса коммитов.
- **Reset --soft/--hard** — для управления историей коммитов.
- **Stash** — для временного сохранения изменений.

Используйте эти команды с учётом их влияния на историю и совместную работу в команде. Для углублённого изучения обратитесь к официальной документации Git и ресурсам, указанным выше.
